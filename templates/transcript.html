{% extends "layout.html" %} {% block title %}Transcript for {{ bid_name }}{%
endblock %} {% block head_styles %}
<style>
  .pdf-iframe {
    width: 100%;
    height: 1600px;
    border: 1px solid #ddd;
  }
  h3 {
    margin-bottom: 0.5rem;
  }
  .decision-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 0.2rem;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }
  .decision-btn:last-child {
    margin-right: 0;
  }
  .decision-btn:hover {
    opacity: 0.7;
  }
  .button-container {
    margin-bottom: 20px;
    text-align: center;
  }
  .button-container .btn {
    margin: 0 10px;
  }
</style>
{% endblock %} {% block content %}
<div class="container-fluid">
  <!-- Button Container -->
  <div class="button-container">
    <a
      href="{{ standard_document_url }}"
      class="btn btn-primary"
      target="_blank"
    >
      View Standard Document
    </a>
    <a
      href="{{ bidder_document_url }}"
      class="btn btn-secondary"
      target="_blank"
    >
      View Bidder's Document
    </a>
  </div>

  <h1 class="mb-4 text-center">Transcript for {{ bid_name }}</h1>
  <div class="row g-1">
    <!-- Section 1: Insertions Table -->
    <div class="col-md-4">
      <h3>Insertions</h3>
      {% if insertions %}
      <div class="table-responsive table-section">
        <table class="table table-striped table-bordered table-hover">
          <thead class="table-success">
            <tr>
              <th>Text</th>
              <th>Remarks</th>
            </tr>
          </thead>
          <tbody>
            {% for insertion in insertions %}
            <tr data-id="{{ insertion.Index }}">
              <td>{{ insertion }}</td>
              <td>
                <div
                  class="d-flex justify-content-start align-items-center gap-0"
                >
                  <button
                    class="decision-btn"
                    onclick="handleDecision('accept', '{{ loop.index }}')"
                    aria-label="Accept Change"
                  >
                    <i
                      class="bi bi-check-circle-fill text-success fs-3"
                      title="Accept"
                    ></i>
                  </button>
                  <button
                    class="decision-btn"
                    onclick="handleDecision('reject', '{{ loop.index }}')"
                    aria-label="Reject Change"
                  >
                    <i
                      class="bi bi-x-circle-fill text-danger fs-3"
                      title="Reject"
                    ></i>
                  </button>
                  <button
                    class="decision-btn"
                    onclick="handleDecision('ignore', '{{ loop.index }}')"
                    aria-label="Ignore Change"
                  >
                    <i
                      class="bi bi-question-circle-fill text-warning fs-3"
                      title="Ignore"
                    ></i>
                  </button>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p>No insertions available.</p>
      {% endif %}
    </div>

    <!-- Section 2: Transcript PDFs -->
    <div class="col-md-4">
      <div class="row">
        <div class="col-12">
          <h3>Generated Transcript PDF</h3>
          {% if generated_pdf_url %}
          <iframe
            src="{{ generated_pdf_url }}"
            class="pdf-iframe"
            title="Generated Transcript PDF"
          ></iframe>
          {% else %}
          <p>Transcript PDF not available.</p>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- Section 3: Deletions Table -->
    <div class="col-md-4">
      <h3>Deletions in Bank Guarantee</h3>
      {% if deletions %}
      <div class="table-responsive table-section">
        <table class="table table-striped table-bordered table-hover">
          <thead class="table-danger">
            <tr>
              <th>Text</th>
              <th>Remarks</th>
            </tr>
          </thead>
          <tbody>
            {% for deletion in deletions %}
            <tr data-id="{{ deletion.Index }}">
              <td>{{ deletion }}</td>
              <td>
                <div
                  class="d-flex justify-content-start align-items-center gap-0"
                >
                  <button
                    class="decision-btn"
                    onclick="handleDecision('accept', '{{ loop.index }}')"
                    aria-label="Accept Change"
                  >
                    <i
                      class="bi bi-check-circle-fill text-success fs-3"
                      title="Accept"
                    ></i>
                  </button>
                  <button
                    class="decision-btn"
                    onclick="handleDecision('reject', '{{ loop.index }}')"
                    aria-label="Reject Change"
                  >
                    <i
                      class="bi bi-x-circle-fill text-danger fs-3"
                      title="Reject"
                    ></i>
                  </button>
                  <button
                    class="decision-btn"
                    onclick="handleDecision('ignore', '{{ loop.index }}')"
                    aria-label="Ignore Change"
                  >
                    <i
                      class="bi bi-question-circle-fill text-warning fs-3"
                      title="Ignore"
                    ></i>
                  </button>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p>No deletions available.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  function handleDecision(action, id) {
    if (!confirm(`Are you sure you want to ${action} change ID ${id}?`)) {
      return;
    }

    fetch(`/decision/${id}`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ action: action }),
    })
      .then((response) => {
        if (!response.ok) {
          throw new Error("Network response was not ok");
        }
        return response.json();
      })
      .then((data) => {
        console.log(data);
        alert(`Decision '${action}' recorded for ID ${id}.`);
        const row = document.querySelector(`tr[data-id="${id}"]`);
        if (row) {
          row.remove();
        }
      })
      .catch((error) => {
        console.error("Error:", error);
        alert("An error occurred while processing your decision.");
      });
  }
</script>
{% endblock %}
